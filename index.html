<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Microfinance Admin</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background: #f5f7fb;
    font-family: Arial, sans-serif;
}

.sidebar {
    width: 240px;
    min-height: 100vh;
    background: #1e293b;
}

.sidebar .nav-link {
    color: #cbd5e1;
    margin-bottom: 10px;
}

.sidebar .nav-link:hover {
    background: #334155;
    border-radius: 8px;
    color: white;
}

.sidebar .active {
    background: #0d6efd;
    border-radius: 8px;
    color: white !important;
}

.main-content {
    background: #f1f5f9;
    min-height: 100vh;
}

.dashboard-card {
    border: none;
    border-radius: 14px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.05);
}
</style>

</head>

<body>

<div class="d-flex">

<div class="sidebar p-3">
    <h4 class="text-white">MicroFinance</h4>
    <hr class="text-white">

    <ul class="nav flex-column">
        <li class="nav-item">
            <a class="nav-link active" href="#">Dashboard</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#">Borrowers</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#">Loans</a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#">Payments</a>
        </li>
    </ul>
</div>

<div class="main-content flex-grow-1">

<nav class="navbar navbar-light bg-white shadow-sm px-4">
    <span class="navbar-brand">Admin Dashboard</span>
</nav>

<div class="container-fluid mt-4">

<div class="row g-4">

<div class="col-md-3">
<div class="card dashboard-card">
<div class="card-body">
<h6>Total Loans</h6>
<h3 id="totalLoans">0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card dashboard-card">
<div class="card-body">
<h6>Today's Collection</h6>
<h3 id="todayCollection">₱0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card dashboard-card">
<div class="card-body">
<h6>Active Borrowers</h6>
<h3 id="activeBorrowers">0</h3>
</div>
</div>
</div>

<div class="col-md-3">
<div class="card dashboard-card">
<div class="card-body">
<h6>Overdue Loans</h6>
<h3 id="overdueLoans">0</h3>
</div>
</div>
</div>

</div>

<div class="card mt-4">
<div class="card-header">
Recent Loans
</div>

<div class="card-body">

<table class="table table-striped">
<thead>
<tr>
<th>Borrower</th>
<th>Amount</th>
<th>Status</th>
<th>Date</th>
</tr>
</thead>

<tbody id="loanTable">
</tbody>

</table>

</div>
</div>

</div>
</div>
</div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbzJPQZw9vc81-X2GzYKUB44tk7q7IJQJG7lfmVG8mAnjcBOED0Jn700WmH13-Zv2ZJTDQ/exec";

async function fetchData(action) {
    const response = await fetch(`${API_URL}?action=${action}`);
    const data = await response.json();
    return data;
}

async function updateDashboard() {
    // ----------------------
    // Active Borrowers
    // ----------------------
    const borrowers = await fetchData("borrowers");
    const activeBorrowers = borrowers.filter(b => b.Status === "Active").length;
    document.getElementById("activeBorrowers").innerText = activeBorrowers;

    // ----------------------
    // Total Loans
    // ----------------------
    const loans = await fetchData("loans");
    document.getElementById("totalLoans").innerText = loans.length;

    // ----------------------
    // Overdue Loans
    // ----------------------
    const overdueLoans = loans.filter(l => l.Status.toLowerCase() === "overdue").length;
    document.getElementById("overdueLoans").innerText = overdueLoans;

    // ----------------------
    // Today Collection
    // ----------------------
    const payments = await fetchData("payments");
    if(payments.length === 0){
        document.getElementById("todayCollection").innerText = "₱0";
    } else {
        const today = new Date();
        const todayPayments = payments.filter(p => {
            const d = new Date(p.PaymentDate);
            return d.getDate() === today.getDate() &&
                   (d.getMonth()+1) === (today.getMonth()+1) &&
                   d.getFullYear() === today.getFullYear();
        });
        const totalToday = todayPayments.reduce((sum, p) => sum + Number(p.AmountPaid), 0);
        document.getElementById("todayCollection").innerText = `₱${totalToday}`;
    }
}

// Run the dashboard update
updateDashboard();
    </script>



</body>
</html>
